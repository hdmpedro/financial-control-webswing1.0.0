var f=Object.defineProperty;var y=(h,e,n)=>e in h?f(h,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):h[e]=n;var a=(h,e,n)=>(y(h,typeof e!="symbol"?e+"":e,n),n);import"./webswing-webcomponents-8b5589e8.js";import{d as I,g as p}from"./utils-09aa2f1a.js";class T{constructor(e){a(this,"parent");a(this,"args");a(this,"connectionUrl");a(this,"elementSelectedTab");a(this,"elementTable");a(this,"elementMap");a(this,"elementIntro");a(this,"elementToast");a(this,"elementTabs");a(this,"elementCreateForm");a(this,"elementEditForm");a(this,"elementModalEditItem");a(this,"elementModalCreateItem");a(this,"elementModalDeleteItem");a(this,"elementWebswingRoot");a(this,"elementCreateRecord");a(this,"_webswingInstance");a(this,"getArrayOfTableCols",e=>{const n=this.elementTable.data.map(t=>t[e]);return Array.from(new Set(n))});a(this,"getServerUrl",()=>{const e=window.location.href;return e.substring(0,e.indexOf("/migration-examples"))+"/migration-examples"});a(this,"webswingInit",()=>{I.getWebswingApi(this.connectionUrl).then(e=>{this.webswingInstance=e.bootstrap(this.elementWebswingRoot,{connectionUrl:this.connectionUrl,autoStart:!1,args:this.args,debugPort:Number(p("debugPort")),onReady:()=>{var n;this.elementWebswingRoot.classList.add("authenticated"),(n=this.webswingInstance)==null||n.start()}},n=>{n.services.dialog.content.continueOldSessionDialog=null,n.services.base.handleActionEvent=(t,o)=>{var l,m;if(t==="initialize"&&((l=this.webswingInstance)==null||l.performAction({actionName:"switchStage",data:"4"}),(m=this.webswingInstance)==null||m.performAction({actionName:"getTableData"})),t==="setTableData"){const r=JSON.parse(o);this.uiTableInit(r)}if(t==="clickedAddButton"){const r=this.elementModalCreateItem,i=this.elementCreateForm;if(r.header="Create Nobel prize winner record",r.show=!0,o){const{categoryList:d,countryList:s}=JSON.parse(o);i.categories=d,i.countries=s}r.addEventListener("close",d=>{var s;if(d.detail==="ok"){const c=JSON.stringify(i.data);(s=this.webswingInstance)==null||s.performAction({actionName:"createItem",data:c}),i.reset()}})}if(t==="editWinner"){const r=this.elementModalEditItem,i=this.elementEditForm;if(r.header="Edit Nobel prize winner record",r.show=!0,o){const{categoryList:d,countryList:s,nobelPrizeWinner:c,row:b}=JSON.parse(o);i.categories=d,i.countries=s,i.data=c,r.addEventListener("close",u=>{var w;if(u.detail==="ok"){i.data.row=b;const g=JSON.stringify(i.data);(w=this.webswingInstance)==null||w.performAction({actionName:"editItem",data:g})}})}}}})}).catch(e=>{console.error(e)})});a(this,"uiTableInit",e=>{var i,d;const n=this.elementToast,t=this.elementTable,o=this.elementModalCreateItem,l=this.elementCreateForm,m=this.elementMap;t.headers=["ID","Name","Category","Award Year","Country"],t.data=e;const r=s=>{var c;o.removeEventListener("close",r),s.detail==="ok"&&(t.createRow(l.data),(c=this.webswingInstance)==null||c.performAction({actionName:"createItem",data:JSON.stringify(l.data)}),n.show("Record has been created sucessfuly"))};(d=(i=t.shadowRoot)==null?void 0:i.querySelector("button[data-id='createRecord']"))==null||d.addEventListener("click",()=>{o.header="Create Nobel prize winner record",l.categories=this.getArrayOfTableCols("category"),l.countries=this.getArrayOfTableCols("country"),o.show=!0}),m.addEventListener("click",s=>{const c=s.composedPath()[0].getAttribute("data-name");c&&(t.search=c)}),o.addEventListener("close",r),t.addEventListener("viewRow",s=>{this.createDetailClosableTab(s.detail)}),t.addEventListener("editRow",s=>{this.editSingleTableRow(s.detail)}),t.addEventListener("deleteRow",s=>{this.deleteSingleTableRow(s.detail)}),t.addEventListener("selectRow",s=>{m.active=s.detail})});this.parent=e,this.args="",this.connectionUrl=this.getServerUrl(),this.elementTable=e.querySelector("ws-table"),this.elementMap=e.querySelector("ws-map"),this.elementSelectedTab=e.querySelector('ws-tab[selected="true"]'),this.elementIntro=e.querySelector("ws-intro"),this.elementToast=e.querySelector("ws-toast"),this.elementTabs=e.querySelector("ws-tabs"),this.elementCreateForm=e.querySelector('ws-detail-form[data-id="createForm"]'),this.elementEditForm=e.querySelector('ws-detail-form[data-id="editForm"]'),this.elementModalEditItem=e.querySelector('ws-modal[data-id="editRecord"]'),this.elementModalCreateItem=e.querySelector('ws-modal[data-id="createRecord"]'),this.elementWebswingRoot=e.querySelector('[data-id="webswing-table"]'),this.elementModalDeleteItem=e.querySelector('ws-modal[data-id="deleteRecord"]'),this.elementCreateRecord=e.querySelector('button[data-id="createRecord"]'),this.webswingInit(),this.uiIntro()}get webswingInstance(){return this._webswingInstance}set webswingInstance(e){this._webswingInstance=e}createDetailClosableTab(e){const n=document.createElement("ws-tab"),t=document.createElement("ws-detail-form");n.label=e.name,this.elementTabs.appendChild(n),n.appendChild(t),this.elementTabs.selectTab(n),n.closable=!0,t.data=e,t.readonly=!0}editSingleTableRow(e){if(!e)return;const n=this.elementTable,t=this.elementModalEditItem,o=this.elementEditForm,l=this.elementToast;t.header="Edit Nobel prize winner record",t.show=!0,o.categories=this.getArrayOfTableCols("category"),o.countries=this.getArrayOfTableCols("country"),o.data=e;const m=r=>{var i;if(t.removeEventListener("close",m),r.detail==="ok"){const d=n.data.findIndex(c=>{var b;return c.id===((b=o.data)==null?void 0:b.id)});n.updateRow(d,o.data);const s=JSON.stringify(o.data);(i=this.webswingInstance)==null||i.performAction({actionName:"editListItem",data:s}),l.show("Record has been updated sucessfuly")}};t.addEventListener("close",m)}deleteSingleTableRow(e){if(!e)return;const n=this.elementTable,t=this.elementModalDeleteItem,o=this.elementToast;t.header="Remove Nobel prize winner record",t.show=!0;const l=m=>{var r;if(t.removeEventListener("close",l),m.detail==="ok"){const i=n.data.findIndex(d=>d.name===e.name);i!=null&&(n.deleteRow(i),(r=this.webswingInstance)==null||r.performAction({actionName:"removeItem",data:JSON.stringify(e)}),o.show("Record has been deleted sucessfuly"))}};t.addEventListener("close",l)}uiIntro(){this.elementIntro.addEventListener("introClick",()=>{const e=this.elementTabs,n=this.parent.querySelectorAll("ws-tab")[1];e.selectTab(n)})}}new T(document.body);
//# sourceMappingURL=stage4-f98d9c2f.js.map
